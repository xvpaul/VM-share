server { listen 80; server_name vmshare.ru www.vmshare.ru; # --- General --- client_max_body_size 2G; # allow big file uploads # --- API (FastAPI backend) --- location /api/ { proxy_pass http://127.0.0.1:8000; proxy_http_version 1.1; # Stream uploads directly (no buffering in Nginx) proxy_request_buffering off; # Forward headers proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_read_timeout 3600s; proxy_send_timeout 3600s; # Donâ€™t buffer big downloads in memory proxy_buffering off; # --- CORS --- add_header 'Access-Control-Allow-Origin' 'https://vmshare.ru' always; add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always; add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type' always; # Preflight (OPTIONS) handler if ($request_method = OPTIONS) { add_header 'Access-Control-Allow-Origin' 'https://vmshare.ru'; add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS'; add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type'; add_header 'Access-Control-Max-Age' 86400; return 204; } } # --- Frontend (your web app / UI) --- location / { proxy_pass http://127.0.0.1:8000; proxy_http_version 1.1; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_read_timeout 60s; proxy_send_timeout 60s; proxy_buffering on; proxy_buffers 8 16k; proxy_busy_buffers_size 32k; } }